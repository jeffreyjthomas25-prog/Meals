<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Recipes and Meal Planning</title>
<style>
  body{margin:0;font-family:sans-serif;background:#e6f4f1;color:#333;}
  nav{background:#14532d;display:flex;justify-content:center;padding:12px;flex-wrap:wrap;}
  nav a{color:white;margin:5px 15px;text-decoration:none;font-weight:bold;cursor:pointer;}
  nav a.active{text-decoration:underline;}
  .container{max-width:900px;margin:20px auto;padding:20px;background:white;border-radius:12px;}
  .hidden{display:none;}
  input,textarea{width:100%;padding:8px;margin-top:5px;border-radius:6px;border:1px solid #ccc;}
  button{background:#16a34a;color:white;border:none;padding:10px 16px;border-radius:6px;cursor:pointer;margin-top:10px;}
  button:hover{background:#15803d;}
  ul{list-style:none;padding:0;}
  li{background:#e6f4ea;border-radius:8px;margin-bottom:8px;padding:10px;display:flex;justify-content:space-between;align-items:center;}
  .calendar{display:grid;grid-template-columns:repeat(7,1fr);gap:8px;margin-top:20px;}
  .day{background:#d1fae5;border-radius:8px;min-height:120px;padding:8px;}
  .day h4{text-align:center;background:#14532d;color:white;border-radius:4px;margin:0 0 6px 0;}
  .draggable{background:#4ade80;color:white;border-radius:6px;padding:5px;margin-top:5px;cursor:grab;}
  .card{background:#f0fdf4;padding:6px;border-radius:6px;margin:4px 0;cursor:pointer;}
  img.recipe-img{max-width:100%;border-radius:8px;margin-top:5px;}
</style>
</head>
<body>

<nav>
  <a href="#" id="nav-home">Home</a>
  <a href="#" id="nav-add">Add Recipe</a>
  <a href="#" id="nav-scrape">Scrape Recipe</a>
  <a href="#" id="nav-book">Recipe Book</a>
  <a href="#" id="nav-meal">Meal Planner</a>
</nav>

<div class="container">

  <section id="home-section">
    <h1 style="text-align:center;color:#14532d;">Recipes and Meal Planning</h1>
    <p style="text-align:center;">Welcome! Add recipes manually or scrape them from a URL, browse your recipe book, and plan your weekly meals.</p>
    <img src="https://images.unsplash.com/photo-1504674900247-0877df9cc836?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&q=80&w=800" style="width:100%;border-radius:12px;margin-top:20px;">
  </section>

  <section id="add-section" class="hidden">
    <h2>Add Recipe</h2>
    <form id="add-form">
      <label>Title</label><input type="text" id="add-title" required>
      <label>Ingredients (one per line)</label><textarea id="add-ingredients" rows="4" required></textarea>
      <label>Instructions</label><textarea id="add-instructions" rows="4" required></textarea>
      <label>Upload Image</label><input type="file" id="add-image" accept="image/*">
      <button type="submit">Add Recipe</button>
    </form>
  </section>

  <section id="scrape-section" class="hidden">
    <h2>Scrape Recipe from URL</h2>
    <input type="url" id="scrape-url" placeholder="https://example.com/recipe">
    <button id="scrape-btn">Scrape Recipe</button>
    <p id="scrape-status" style="color:#14532d;margin-top:10px;"></p>
  </section>

  <section id="book-section" class="hidden">
    <h2>Recipe Book</h2>
    <ul id="recipe-list"></ul>
    <div id="no-recipes" style="text-align:center;color:#777;">No recipes yet.</div>
  </section>

  <section id="meal-section" class="hidden">
    <h2>Meal Planner</h2>
    <div class="calendar" id="calendar">
      <div class="day" data-day="Monday"><h4>Monday</h4></div>
      <div class="day" data-day="Tuesday"><h4>Tuesday</h4></div>
      <div class="day" data-day="Wednesday"><h4>Wednesday</h4></div>
      <div class="day" data-day="Thursday"><h4>Thursday</h4></div>
      <div class="day" data-day="Friday"><h4>Friday</h4></div>
      <div class="day" data-day="Saturday"><h4>Saturday</h4></div>
      <div class="day" data-day="Sunday"><h4>Sunday</h4></div>
    </div>
    <h3>Your Recipes</h3>
    <div id="recipe-pool"></div>
  </section>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyA2hOiQV4oiMf8YGlXMsK7vMbsdWonAsYE",
  authDomain: "meal-recipe-b7753.firebaseapp.com",
  projectId: "meal-recipe-b7753",
  storageBucket: "meal-recipe-b7753.firebasestorage.app",
  messagingSenderId: "775365507411",
  appId: "1:775365507411:web:eb8406b1d1b27dd6c609a6"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let recipes=[];
let mealPlan=JSON.parse(localStorage.getItem('mealPlan')||'{}');

async function loadRecipesFromFirestore(){
  const q=query(collection(db,"recipes"),orderBy("timestamp","desc"));
  const snapshot=await getDocs(q);
  recipes=snapshot.docs.map(doc=>({id:doc.id,...doc.data()}));
}

function showSection(name){
  ['home','add','scrape','book','meal'].forEach(s=>{
    document.getElementById(s+'-section').classList.add('hidden');
    document.getElementById('nav-'+s).classList.remove('active');
  });
  document.getElementById(name+'-section').classList.remove('hidden');
  document.getElementById('nav-'+name).classList.add('active');

  if(name==='book'){ loadRecipesFromFirestore().then(renderBook); }
  if(name==='meal'){ renderMealPlanner(); }
}

document.querySelectorAll('nav a').forEach(a=>{
  a.addEventListener('click', e=>{
    e.preventDefault();
    const target=a.id.replace('nav-','');
    showSection(target);
  });
});

document.getElementById('add-form').addEventListener('submit', async e=>{
  e.preventDefault();
  const title=document.getElementById('add-title').value.trim();
  const ingredients=document.getElementById('add-ingredients').value.trim();
  const instructions=document.getElementById('add-instructions').value.trim();
  const file=document.getElementById('add-image').files[0];

  let reader=null;
  if(file){ reader=new FileReader(); reader.readAsDataURL(file); await new Promise(res=>reader.onload=()=>res()); }

  await addDoc(collection(db,"recipes"),{
    title, ingredients, instructions, image:reader?reader.result:null, timestamp:Date.now()
  });

  e.target.reset();
  alert("Recipe saved!");
  await loadRecipesFromFirestore();
  renderBook();
});

document.getElementById('scrape-btn').addEventListener('click', async ()=>{
  const url=document.getElementById('scrape-url').value.trim();
  const status=document.getElementById('scrape-status');
  if(!url){ status.textContent="Please enter a URL!"; return; }
  status.textContent="Fetching recipe...";
  // Demo: fake scraping data
  const newRecipe={
    title:"Scraped Recipe",
    ingredients:"1 cup example\n2 tbsp something\nSalt to taste",
    instructions:"1. Mix\n2. Cook\n3. Serve",
    image:null,
    timestamp:Date.now()
  };
  await addDoc(collection(db,"recipes"), newRecipe);
  status.textContent="Recipe added!";
  document.getElementById('scrape-url').value="";
  await loadRecipesFromFirestore();
  renderBook();
  renderMealPlanner();
});

function renderBook(){
  const list=document.getElementById('recipe-list');
  const noRecipes=document.getElementById('no-recipes');
  list.innerHTML='';
  if(recipes.length===0){ noRecipes.style.display='block'; return; }
  noRecipes.style.display='none';
  recipes.forEach(r=>{
    const li=document.createElement('li');
    li.innerHTML=`<span>${r.title}</span>`;
    if(r.image) li.innerHTML+=`<img src="${r.image}" class="recipe-img">`;
    list.appendChild(li);
  });
}

function renderMealPlanner(){
  const pool=document.getElementById('recipe-pool');
  pool.innerHTML='';
  recipes.forEach(r=>{
    const div=document.createElement('div');
    div.className='draggable';
    div.textContent=r.title;
    div.dataset.id=r.id;
    div.draggable=true;
    div.addEventListener('dragstart', e=>e.dataTransfer.setData('text/plain',r.id));
    pool.appendChild(div);
  });

  document.querySelectorAll('.day').forEach(day=>{
    day.innerHTML=`<h4>${day.dataset.day}</h4>`;
    const meals=mealPlan[day.dataset.day]||[];
    meals.forEach(id=>{
      const recipe=recipes.find(r=>r.id===id);
      if(recipe){
        const card=document.createElement('div');
        card.className='card';
        card.textContent=recipe.title;
        card.ondblclick=()=>{ mealPlan[day.dataset.day]=mealPlan[day.dataset.day].filter(x=>x!==id); localStorage.setItem('mealPlan',JSON.stringify(mealPlan)); renderMealPlanner(); };
        day.appendChild(card);
      }
    });
    day.addEventListener('dragover', e=>e.preventDefault());
    day.addEventListener('drop', e=>{
      const rid=e.dataTransfer.getData('text/plain');
      if(!mealPlan[day.dataset.day]) mealPlan[day.dataset.day]=[];
      mealPlan[day.dataset.day].push(rid);
      localStorage.setItem('mealPlan',JSON.stringify(mealPlan));
      renderMealPlanner();
    });
  });
}

showSection('home');
</script>

</body>
</html>
